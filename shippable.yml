language: ruby

build_image: shippableimages/ubuntu1204_ruby:0.0.1

rvm: 
  - 2.1.1

env: 
  - CI_REPORTS=shippable/testresults COVERAGE_REPORTS=shippable/codecoverage

before_install:
  # Install elasticsearch and dependencies
  - apt-get -y install openjdk-7-jre-headless
  - curl -O https://download.elasticsearch.org/elasticsearch/elasticsearch/elasticsearch-1.4.2.deb
  - dpkg -i elasticsearch-1.4.2.deb
  # setup rvm
  - source ~/.rvm/scripts/rvm
  - rvm install $SHIPPABLE_RUBY --verify-downloads 1
  - source ~/.bashrc && ~/.rvm/scripts/rvm && rvm use $SHIPPABLE_RUBY

install:
  - bundle install --gemfile="Gemfile"
  - ruby -v

# Invoke elasticsearch
before_script:
  - /usr/share/elasticsearch/bin/elasticsearch &

script:
  - bundle exec rake
